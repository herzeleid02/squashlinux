## This program is a part of a bigger project
## https://github.com/herzeleid02/squashlinux
# some of the code was stolen from distrobox-create :)

#!/bin/bash # i think u can run this in any posix compatible shell

version="0.1"
verbose=0
verbose_key=""
dryrun=0 ##why
container_image=""
tmp_dir="/tmp/tar-$(date +%d%m%Y)-$(tr -dc a-z </dev/urandom | head -c 4)" # actually not neccessary
flush=0 # it should not remove any already pulled images
chroot_directory=""

# parsing args

while :; do
	case $1 in
		-h | --help)
			# Call a "show_help" function to display a synopsis, then exit.
			show_help
			exit 0
			;;
		-v | --verbose)
			verbose=1
			#verbose_key="s
			shift
			;;
		-V | --version)
			printf "distrobox: %s\n" "${version}"
			exit 0
			;;
		-i | --image)
			if [ -n "$2" ]; then
				container_image="$2"
				shift
				shift
			fi
			;;
		-F | --flush) # function to then remove the image from the host
			flush=1
			shift
			;;
		-t | --target-directory)
			if [ -n "$2" ]; then
				chroot_directory="$2"
				shift
				shift
			fi
			;;
		--) # End of all options.
			shift
			break
			;;
		-*) # Invalid options.
			printf >&2 "ERROR: Invalid flag '%s'\n\n" "$1"
			show_help
			exit 1
			;;
		*) # Default case: If no more options then break out of the loop.
			# If we have a flagless option and container_name is not specified
			# then let's accept argument as container_name
			if [ -n "$1" ]; then
				container_name="$1"
				chroot_directory="$2"
				shift
			else
				break
			fi
			;;
	esac
done

if [ "${verbose}" -ne 0 ]; then
	set -o xtrace
fi

function show_help(){
	cat << EOF
hello world
EOF
}

# the program (aka the main function)

# test if directory exists

if [ ! -d "$chroot_directory" ]; then
	show_help	
	exit 1;
fi

podman save ${container_image} | tar -xf "*.tar" -C ${chroot_directory}
